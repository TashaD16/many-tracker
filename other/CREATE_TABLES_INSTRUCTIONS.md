# Инструкция по созданию таблиц в Supabase

## Быстрый способ

### Шаг 1: Откройте Supabase SQL Editor

1. Войдите в Supabase Dashboard
2. Выберите ваш проект
3. Перейдите в **SQL Editor** (в левом меню)

### Шаг 2: Выполните SQL скрипт

1. Откройте файл `backend/supabase-create-tables.sql`
2. Скопируйте весь содержимое
3. Вставьте в SQL Editor в Supabase
4. Нажмите **Run** (или Ctrl+Enter)

### Шаг 3: Проверка

После выполнения скрипта проверьте:

1. Перейдите в **Table Editor**
2. Вы должны увидеть следующие таблицы:
   - ✅ User
   - ✅ Account
   - ✅ Category
   - ✅ Transaction
   - ✅ Transfer
   - ✅ Budget
   - ✅ CurrencyRate

## Что создается

### Таблицы:
1. **User** - профили пользователей (связана с auth.users)
2. **Account** - счета пользователей
3. **Category** - категории доходов/расходов
4. **Transaction** - транзакции
5. **Transfer** - переводы между счетами
6. **Budget** - бюджеты по категориям
7. **CurrencyRate** - курсы валют

### Безопасность:
- ✅ Row Level Security (RLS) включен для всех таблиц
- ✅ Политики безопасности настроены
- ✅ Пользователи видят только свои данные

### Автоматизация:
- ✅ Триггер для создания профиля при регистрации
- ✅ Триггеры для обновления `updatedAt`
- ✅ Индексы для быстрого поиска

## Альтернативный способ (через Prisma)

Если предпочитаете использовать Prisma миграции:

```bash
cd backend
npx prisma generate
npx prisma migrate dev --name init
```

Затем выполните в Supabase SQL Editor:
- Связь User с auth.users (из `backend/supabase-create-tables.sql`)
- RLS политики (из `backend/supabase-rls-policies.sql`)
- Триггер для создания профиля (из `backend/supabase-create-tables.sql`)

## Проверка работы

После создания таблиц:

1. Зарегистрируйте пользователя через приложение
2. Проверьте в Supabase Table Editor → User - должен появиться профиль
3. Создайте счет, категорию, транзакцию
4. Проверьте, что данные видны только текущему пользователю

## Troubleshooting

### Ошибка: "relation already exists"
- Таблицы уже созданы, это нормально
- Скрипт использует `CREATE TABLE IF NOT EXISTS`

### Ошибка: "permission denied"
- Убедитесь, что используете правильный проект
- Проверьте права доступа к базе данных

### Ошибка: "foreign key constraint"
- Убедитесь, что таблица User создана первой
- Проверьте порядок выполнения команд

## Готово! ✅

После выполнения скрипта все таблицы созданы и готовы к использованию.
